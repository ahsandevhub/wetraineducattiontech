generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["auth", "public"]
}

/* =========================
   AUTH (Supabase) — keep ONLY what you need
   ========================= */
model users {
  instance_id                 String?   @db.Uuid
  id                          String    @id @db.Uuid
  aud                         String?   @db.VarChar(255)
  role                        String?   @db.VarChar(255)
  email                       String?   @db.VarChar(255)
  encrypted_password          String?   @db.VarChar(255)
  email_confirmed_at          DateTime? @db.Timestamptz(6)
  invited_at                  DateTime? @db.Timestamptz(6)
  confirmation_token          String?   @db.VarChar(255)
  confirmation_sent_at        DateTime? @db.Timestamptz(6)
  recovery_token              String?   @db.VarChar(255)
  recovery_sent_at            DateTime? @db.Timestamptz(6)
  email_change_token_new      String?   @db.VarChar(255)
  email_change                String?   @db.VarChar(255)
  email_change_sent_at        DateTime? @db.Timestamptz(6)
  last_sign_in_at             DateTime? @db.Timestamptz(6)
  raw_app_meta_data           Json?
  raw_user_meta_data          Json?
  is_super_admin              Boolean?
  created_at                  DateTime? @db.Timestamptz(6)
  updated_at                  DateTime? @db.Timestamptz(6)
  phone                       String?   @unique
  phone_confirmed_at          DateTime? @db.Timestamptz(6)
  phone_change                String?   @default("")
  phone_change_token          String?   @default("") @db.VarChar(255)
  phone_change_sent_at        DateTime? @db.Timestamptz(6)
  confirmed_at                DateTime? @default(dbgenerated("LEAST(email_confirmed_at, phone_confirmed_at)")) @db.Timestamptz(6)
  email_change_token_current  String?   @default("") @db.VarChar(255)
  email_change_confirm_status Int?      @default(0) @db.SmallInt
  banned_until                DateTime? @db.Timestamptz(6)
  reauthentication_token      String?   @default("") @db.VarChar(255)
  reauthentication_sent_at    DateTime? @db.Timestamptz(6)
  is_sso_user                 Boolean   @default(false)
  deleted_at                  DateTime? @db.Timestamptz(6)
  is_anonymous                Boolean   @default(false)

  // Reverse relation (optional) — since this model is ignored, this won't be used anyway
  profiles Profile? @ignore

  @@index([instance_id])
  @@index([is_anonymous])
  @@schema("auth")
  @@ignore
}

/* =========================
   PUBLIC (Your App)
   ========================= */

model Profile {
  id         String    @id @db.Uuid
  fullName   String?   @map("full_name")
  phone      String?
  avatarUrl  String?   @map("avatar_url")
  role       user_role @default(customer)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  email      String?   @unique @map("email")
  address    String?
  city       String?
  state      String?
  postalCode String?   @map("postal_code")
  country    String?   @default("BD")

  orders   Order[]
  payments Payment[]

  // Since `users` model is ignored, this relation field MUST be ignored too
  users users @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction) @ignore

  @@index([createdAt(sort: Desc)], map: "idx_profiles_created_at_desc")
  @@index([email], map: "idx_profiles_email")
  @@index([role], map: "idx_profiles_role")
  @@map("profiles")
  @@schema("public")
}

model Order {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String        @map("user_id") @db.Uuid
  packageName String        @map("package_name")
  amount      Decimal       @db.Decimal
  status      String        @default("pending")
  createdAt   DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  orderNo     String?       @unique @map("order_no")
  currency    String?       @default("BDT")

  profile     Profile       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([createdAt(sort: Desc)], map: "idx_orders_created_at_desc")
  @@index([status], map: "idx_orders_status")
  @@index([userId], map: "idx_orders_user_id")
  @@map("orders")
  @@schema("public")
}

model Payment {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId     String    @map("user_id") @db.Uuid
  amount     Decimal   @db.Decimal
  method     String
  status     String    @default("pending")
  reference  String?
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  provider   String?
  currency   String?   @default("BDT")
  service    String?

  profile Profile @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([createdAt(sort: Desc)], map: "idx_payments_created_at_desc")
  @@index([method], map: "idx_payments_method")
  @@index([status], map: "idx_payments_status")
  @@index([userId], map: "idx_payments_user_id")
  @@map("payments")
  @@schema("public")
}

model certifications {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String
  issuer        String
  issued_at     String
  description   String
  credential_id String?
  verify_url    String?
  image_url     String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model client_stories {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  role        String
  quote       String
  achievement String
  rating      Int       @default(5)
  image_url   String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model featured_projects {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String
  slug               String    @unique
  category           String
  description        String
  tech_stack         String[]  @default([])
  featured_image_url String
  live_url           String?
  github_url         String?
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model services {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String
  slug               String           @unique
  category           service_category
  price              Decimal?         @db.Decimal
  discount           Decimal?         @db.Decimal
  currency           String           @default("BDT")
  details            String?
  key_features       String[]         @default([])
  featured_image_url String
  created_at         DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?        @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

enum service_category {
  course
  software
  marketing

  @@schema("public")
}

enum user_role {
  customer
  admin

  @@schema("public")
}
